@page "/wiki/history/{title}/{version?}"
@model velociraptor.Pages.HistoryModel
@{
    ViewData["Title"] = @Model.Article.Title;
}

@functions {
    public void FragmentsSeparator(Model.Fragment fragment, bool next)
    {
        if (fragment.Type == velociraptor.Model.History.ChangeType.Deleted)
        {
            if (!next)
            {
                <span class="deleted-text">@fragment.Text</span>
            }
        }
        else if (fragment.Type == velociraptor.Model.History.ChangeType.Inserted)
        {
            if (next)
            {
                <span class="inserted-text">@fragment.Text</span>
            }
        }
        else
        {
                @fragment.Text
        }

        if (!fragment.NoNewLine)
        {
            <br/>
        }
    }

    public void DiffColumn(string padding, string href, string hrefText, int version, string date, bool isNext)
    {
        {
            <div class="column normal-text @padding">
                @if (version != 0)
                {
                    <a class="normal-link" href="@href">@hrefText</a><br/>
                }
                else
                {
                    @hrefText<br/>
                }
                <h1 class="display-6 top-space">@date</h1>
                @foreach (Model.Fragment fragment in Model.Fragments)
                {
                    FragmentsSeparator(fragment, next: isNext);
                }
            </div>
        }
    }
}

<p class="display-3">@ViewData["Title"]</p>

<br/>

<div class="table text-center">
    @{
        DiffColumn("right-padding", Model.PrevVersionLink, "Previous version",
            Model.PrevVersion, Model.ChangeDatePrev.ToString(), false);

        DiffColumn("left-padding", Model.NextVersionLink, "Next version",
            Model.NextVersion, Model.ChangeDateNext.ToString(), true);
    }
</div>
